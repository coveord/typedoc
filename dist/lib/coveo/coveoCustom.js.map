{"version":3,"file":"coveoCustom.js","sourceRoot":"","sources":["../../../src/lib/coveo/coveoCustom.ts"],"names":[],"mappings":"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","sourcesContent":["import { Reflection, ReflectionFlag, CommentTag } from \"../models\";\nimport { parseComment } from \"../converter/factories/comment\";\nimport { Converter } from \"../converter\";\n\nexport interface ICoveoDisplayTemplateFunction {\n  (rawValue?: string, result?: Reflection): string;\n}\n\nexport class CoveoCustomTag {\n  public displayName: string;\n  public displayTemplate: ICoveoDisplayTemplateFunction;\n  public rawName?: string;\n  public rawValue?: string;\n\n  constructor(displayName: string, displayTemplate: ICoveoDisplayTemplateFunction, rawName?: string, rawValue?: string) {\n    this.displayName = displayName;\n    this.displayTemplate = displayTemplate;\n    this.rawName = rawName;\n    this.rawValue = rawValue;\n  }\n}\n\nexport interface IParsedCoveoBuildOptionArgs {\n  required?: CoveoCustomTag,\n  defaultValue?: CoveoCustomTag,\n  depend?: CoveoCustomTag,\n  min?: CoveoCustomTag,\n  max?: CoveoCustomTag,\n  float?: CoveoCustomTag\n}\n\nexport class CoveoCustom {\n  static parseBuildOptionArgs(buildOptionArgs: string): IParsedCoveoBuildOptionArgs {\n    let parsedBuildOptionArgs: IParsedCoveoBuildOptionArgs = {};\n\n    const required = buildOptionArgs.match(/required\\s*:\\s([a-zA-Z]+)\\s*/);\n    if (required) {\n        parsedBuildOptionArgs.required = new CoveoCustomTag(\n          \"Required\",\n          () => { return \"Specifying a value for this option is required for the component to work\"; },\n          null,\n          required[1]);\n    }\n\n    let depend = buildOptionArgs.match(/depend\\s*:\\s('[a-zA-Z]+'|\"[a-zA-Z]+\")\\s*/);\n    if (depend) {\n        parsedBuildOptionArgs.depend = new CoveoCustomTag(\n          \"Only effective when\",\n          (rawValue, result) => {return `[\\`${rawValue}\\`]{@link ${result.parent.parent.name}.options.${rawValue}} is [truthy](https://developer.mozilla.org/en-US/docs/Glossary/Truthy)`;},\n          null,\n          depend[1].replace(/(['\"])([a-zA-Z]+)(['\"])/, '$2'));\n    }\n\n    const min = buildOptionArgs.match(/min\\s*:\\s(\\d+(\\.\\d+)?)\\s*/);\n    if (min) {\n        parsedBuildOptionArgs.min = new CoveoCustomTag(\n          \"Minimum\",\n          (rawValue) => { return `\\`${rawValue}\\``; },\n          null,\n          min[1]);\n    }\n\n    const max = buildOptionArgs.match(/max\\s*:\\s(\\d+(\\.\\d+)?)\\s*/);\n    if (max) {\n        parsedBuildOptionArgs.max = new CoveoCustomTag(\n          \"Maximum\",\n          (rawValue) => { return `\\`${rawValue}\\``; },\n          null,\n          max[1]);\n    }\n\n    const float = buildOptionArgs.match(/float\\s*:\\s(true|false)\\s/);\n    if (float) {\n        parsedBuildOptionArgs.float = new CoveoCustomTag(\n          \"Accepts floating point values\",\n          () => { return \"\"; },\n          null,\n          float[1]);\n    }\n\n    let defaultValue = buildOptionArgs.match(/defaultValue\\s*:\\s(-?\\d+(\\.\\d+)?|true|false|'[^']*'|\"[^\"]*\"|l\\(('[^']*'|\"[^\"]*\")\\)|l\\(\"[^\"]*\"\\)|\\[('[^']*',?\\s*|\"[^\"]*\",?\\s*)*\\])\\s*/);\n    if (defaultValue) {\n        defaultValue[1] = defaultValue[1].replace('l(', '');\n        defaultValue[1] = defaultValue[1].replace(')', '');\n        defaultValue[1] = defaultValue[1].replace(')', '');\n        defaultValue[1] = defaultValue[1].replace(/'/g, '');\n        parsedBuildOptionArgs.defaultValue = new CoveoCustomTag(\n          \"Default\",\n          (rawValue) => { return `\\`${rawValue}\\``; },\n          null,\n          defaultValue[1]);\n    }\n\n    return parsedBuildOptionArgs;\n  }\n\n  static areResultAndCommentDefined(result: Reflection, comment: string|null) {\n    return result && comment !== null;\n  }\n\n  static setNotSupportedInTag(converter: Converter, result: Reflection, comment: string) {\n    if (comment.indexOf('@notSupportedIn') !== -1) {\n      const tagRegex = /@(?:notSupportedIn)\\s*((?:[\\w]+, )*[\\w]+)/g;\n\n      result.comment = parseComment(comment.replace(tagRegex, \"\"));\n\n      const tag = tagRegex.exec(comment);\n\n      if (!result.comment.tags) {\n          result.comment.tags = [];\n      }\n\n      let tagValue = tag[1];\n      const tagValueInfo = converter.application.notSupportedFeaturesConfig[tagValue];\n      if (tagValueInfo) {\n          tagValue = `<a href=\"${tagValueInfo.link}\">${tagValueInfo.name}</a>`\n      }\n      result.comment.tags.push(new CommentTag('Not supported in', '', tagValue));\n      result.notSupportedIn = tag[1].split(/,\\s?/);\n    }\n  }\n\n\n  static extractOptionCustomMarkupExamples(result: Reflection, comment: string) {\n    if (comment.indexOf('@examples') != -1) {\n      const examplesTagRegex = new RegExp(/@(?:examples)\\s(.*)/);\n\n      result.comment = parseComment(comment.replace(examplesTagRegex, ''));\n\n      const examplesTag = examplesTagRegex.exec(comment);\n      if (!examplesTag || !examplesTag[1]) {\n          return;\n      }\n\n      result.examples = examplesTag[1].split(/(?<!\\\\),/).map(s => s.trim().replace('\\\\,', ',').replace('\\'', '&apos;'));\n    }\n  }\n\n  static setCoveoComponentOptionsFlag(result: Reflection, comment: string) {\n    if (comment.indexOf(\"@componentOptions\") !== -1) {\n      result.setFlag(ReflectionFlag.CoveoComponentOptions, true);\n    }\n  }\n\n  static extractTagsFromComponentBuildOptionArgs(result: Reflection) {\n    if (result.parent && result.parent.comment && result.parent.comment.hasTag(\"componentoptions\") && result.defaultValue) {\n      result.coveoComponentOptionAttributes = CoveoCustom.parseBuildOptionArgs(result.defaultValue)\n      for (let key in result.coveoComponentOptionAttributes) {\n          if (!result.comment.tags) {\n              result.comment.tags = [];\n          }\n          const prop = result.coveoComponentOptionAttributes[key] as CoveoCustomTag;\n          result.comment.tags.push(new CommentTag(\n            prop.displayName,\n            '',\n            prop.displayTemplate(prop.rawValue, result)));\n      }\n    }\n  }\n\n  static additionalCustomTags: CoveoCustomTag[] = [\n    new CoveoCustomTag(\n      \"Available since\",\n      (rawValue) => { return `${rawValue}`; },\n      \"availablesince\",\n      null),\n    new CoveoCustomTag(\n      \"Deprecated since\",\n      (rawValue) => { return `${rawValue}`; },\n      \"deprecatedsince\",\n      null),\n    new CoveoCustomTag(\n      \"Result template component\",\n      () => { return \"This component is intended to be used in [result templates](https://docs.coveo.com/en/413/)\"; },\n      \"isresulttemplatecomponent\",\n      null),\n    new CoveoCustomTag(\n      \"Additional documentation\",\n      (rawValue) => { return `${rawValue}`; },\n      \"externaldocs\",\n      null)\n  ]\n\n  static parseAdditionalCustomTags(result: Reflection) {\n    if (!result.comment) {\n      return;\n    }\n    if (!result.comment.tags) {\n      result.comment.tags = [];\n    }\n    this.additionalCustomTags.forEach((customTag) => {\n      for (let i = 0; i < result.comment.tags.length; i++) {\n        const tag = result.comment.tags[i];\n        if (tag.tagName.toUpperCase() === customTag.rawName.toUpperCase()) {\n          /* Removing the tag and pushing a new one ensures that the custom\n             tags will always get rendered in the desired order (i.e., in the\n             order they appear in the additionalCustomTags array). */\n          result.comment.tags.splice(i, 1);\n          result.comment.tags.push(new CommentTag(\n            customTag.displayName,\n            \"\",\n            customTag.displayTemplate(tag.text)));\n          if (!result.coveoAdditionalAttributes) {\n            result.coveoAdditionalAttributes = [];\n          }\n          result.coveoAdditionalAttributes.push(customTag);\n          break;\n        }\n      }\n    })\n  }\n}\n"]}